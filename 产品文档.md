# 专业数据匹配与校验工具 - 产品需求文档 (PRD)

## 文档版本

| 版本 | 修订日期 | 修订人 | 修订内容 |
|------|----------|--------|----------|
| V1.0 | 2025-07-14 | Gemini | 创建初始文档，包含项目概述、功能详述、匹配与校验逻辑 |

## 1. 项目概述

### 1.1 项目背景与目标

为了提升新专业数据入库的效率和准确性，我们需要开发一款轻量级的内部工具。该工具旨在帮助数据处理人员，将新爬取的专业信息与数据库中现有的专业数据进行快速、准确的匹配，并对新数据进行格式校验与自动修正。

**核心目标:**
- 提升效率: 自动化完成大部分数据匹配与校验工作，减少人工操作时间
- 保证质量: 通过严谨的规则，确保入库数据的准确性，降低错误率
- 易于使用: 提供一个免安装、无后端的在线页面，操作直观，无技术门槛

### 1.2 目标用户
公司内部负责数据入库与管理的数据处理专员

### 1.3 核心价值
- 数据安全: 所有数据处理均在用户本地浏览器完成，不上传任何服务器，确保内部数据安全
- 零成本部署: 无需服务器和数据库维护，一个HTML文件即可分发使用
- 高可用性: 随时随地，有浏览器即可使用，不受环境限制

## 2. 产品功能详述

### 2.1 整体流程说明

1.  **上传文件**:
    *   首先，在 **“① 数据库现有数据”** 上传框中，选择或拖拽包含存量专业数据的Excel文件。
    *   接着，在 **“② 新爬取的待入库数据”** 上传框中，上传包含待处理的新专业信息的Excel文件。

2.  **开始处理**:
    *   两个文件都上传成功后，点击页面上醒目的 **“开始匹配与校验”** 按钮。

3.  **系统执行与等待**:
    *   程序会开始在浏览器本地执行匹配和校验任务，页面会显示当前进度。
    *   核心处理步骤包括：**数据匹配** (为新数据查找ID) -> **数据校验与修正** (标准化字段格式)。

4.  **预览与复核**:
    *   处理完成后，页面下方会生成一个 **结果预览表格**。
    *   表格会通过不同颜色高亮数据行：
        *   **绿色**: 完全匹配，数据无误。
        *   **黄色**: 模糊匹配，需要您人工确认一下。
        *   **红色**: 匹配失败或存在无法自动修正的格式错误。

5.  **导出结果**:
    *   在预览表中确认数据无误后，点击 **“导出处理结果 (.xlsx)”** 按钮。

6.  **完成**:
    *   浏览器将自动下载一个包含所有处理结果的Excel文件，流程结束。

### 2.2 用户界面 (UI) 设计

工具界面分为三个主要区域：

**文件上传区:**
- 包含两个并排的上传框，分别用于"① 数据库现有数据"和"② 新爬取的待入库数据"
- 明确标注每个上传框所需的文件类型，并支持文件拖拽

**控制与状态区:**
- 一个醒目的"开始匹配与校验"按钮
- 处理过程中显示进度状态，如"正在读取文件..."、"匹配完成，开始校验..."
- 处理完成后，"开始"按钮变为不可用，同时出现一个"导出处理结果 (.xlsx)"按钮

**结果预览区:**
- 一个动态生成的表格，展示所有待入库数据（已附加匹配和校验结果）
- 表格包含所有原始列，并新增两列：匹配到的ID 和 处理状态

**颜色高亮规则:**
- 绿色行: 完美匹配且通过所有校验
- 黄色行: 模糊匹配成功，需要人工复核
- 红色行: 匹配失败，或存在无法自动修正的严重格式错误

处理状态列将清晰描述该行数据发生了什么，例如：
- "通过URL精确匹配"
- "模糊匹配 (相似度96%)，建议复核"
- "开学时间格式错误: '2025/13'月份无效"

## 3. 核心功能一：数据匹配

### 3.1 匹配前置处理

在进行任何匹配之前，系统会对所有用于匹配的文本字段进行标准化清洗，这是保证匹配准确率的基础。

- 统一大小写: 全部转换为小写
- 移除标点符号: 移除 () & - 等特殊字符
- 处理空格: 移除首尾空格，并将多个连续的内部空格合并为一个
- URL标准化: 移除协议头 (http://, https://) 和末尾的斜杠 (/)

### 3.2 四级递进匹配模型

系统将对每一条新数据，依次执行以下四级匹配。一旦匹配成功，即绑定ID并停止。

| 优先级 | 匹配级别 | 依据字段 | 匹配逻辑 | 错误率 | 备注 |
|--------|----------|----------|----------|--------|------|
| 1 (最高) | URL精确匹配 | 专业链接 | 标准化后的URL完全相同 | 极低 | 最可靠的唯一标识 |
| 2 (高) | 课程编码精确匹配 | 课程编码 | 课程编码不为空且完全相同 | 极低 | 对URL匹配的有力补充 |
| 3 (中) | 英文名+学位等级智能匹配 | 专业英文名, 学位等级 | 智能组合后精确比对。如果专业英文名已包含学位等级信息，则不重复拼接 | 低 | 核心匹配规则，能处理大部分情况 |
| 4 (辅助) | 中文名+学位等级模糊匹配 | 专业中文名, 学位等级 | 在学位等级相同的前提下，计算专业中文名的字符串相似度 | 可控 | 阈值设定 > 95%。结果标记为"建议复核" |

## 4. 核心功能二：数据校验与修正

在匹配完成后，系统将对所有待入库数据（无论是否匹配成功）进行字段级的校验与修正。

### 4.1 字段："学制"

**目标格式:** 数字/单位，多个值用 , 分隔

**合法单位:** 年, 月, 周, 学期, 学分

**自动修正策略:**
- 统一分隔符: 全角 ／ 替换为半角 /；全角 , 替换为半角 ,
- 清理空格: 移除数字、单位、符号周围的所有空格
- 格式补全: 对 4年 这种缺少 / 的格式，自动补全为 4/年
- 单位别名修正: 修正如 个学期 -> 学期 的情况

**校验规则:**
- 分割后的每个单元必须符合 数字/单位 格式
- / 前必须是有效数字（可含小数点）
- / 后必须是预设的合法单位之一

**错误处理:** 无法自动修正或校验不通过的，在 处理状态 列中明确指出错误原因，如："学制'三学期'格式错误，非有效数字"

### 4.2 字段："开学时间"

**目标格式:** YYYY-MM，多个值用 , 分隔

**自动修正策略:**
- 统一日期分隔符: 将 . 或 / 统一替换为 -
- 清理空格: 移除日期周围的所有空格
- 月份补零: 对 YYYY-M 格式的日期，自动补全为 YYYY-0M

**校验规则:**
- 分割后的每个单元必须符合 YYYY-MM 格式
- 年份必须是有效的四位数字（如 1980-2100）
- 月份必须在 01-12 之间

**错误处理:** 无法自动修正或校验不通过的，在 处理状态 列中明确指出错误原因，如："开学时间'2025-13'月份无效"

## 5. 结果输出

用户点击"导出处理结果"按钮后，系统会生成一个名为 [原始文件名]-processed-[日期].xlsx 的Excel文件并触发下载。

该文件包含"待入库数据"的全部原始列，并新增以下列:
- 专业ID: 匹配到的数据库ID，未匹配上则为空
- 匹配状态: 记录该行数据的处理结果，如"精确匹配"、"模糊匹配，建议复核"、"格式错误：xxx"等

所有字段的值均为经过自动修正后的标准格式

## 6. 非功能性需求

- **技术方案:** 纯HTML/CSS/JavaScript单页应用，核心依赖 SheetJS (xlsx.js) 库
- **性能:** 能够在5秒内完成对两个各包含5000行数据的Excel文件的处理（具体取决于用户电脑性能）
- **安全性:** 所有文件读取和数据处理均在客户端浏览器中完成，不与任何服务器进行数据交互
- **易用性:** 界面简洁，引导清晰，无需说明即可上手